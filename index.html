<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fazzercize Randomizer</title>
  <style>
    html, body { height: 100%; }
    body {
      padding: 1rem;
      box-sizing: border-box;
      font-family: sans-serif;
      background: linear-gradient(135deg, #1e1e1e, #2a2a2a);
      color: #f2f2f2;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      overflow-y: hidden; /* prevent layout nudges on spin */
    }

    @media (max-width: 600px) {
      .rep-box { width: 40px; height: 40px; font-size: 1.5rem; }
      .box { font-size: 1.4rem; width: 90%; min-width: unset; }
      button { padding: 1.5rem 2rem; font-size: 1.2rem; }
    }

    h1 { margin-bottom: 2rem; }
    .card {
      background: #2b2b2b;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      width: 100%; max-width: 400px;
      display: flex; flex-direction: column; align-items: center;
    }
    .box {
      font-size: 1.8rem; margin: 0.5rem 0; padding: 1rem 2rem;
      border: 2px solid; border-radius: 12px; min-width: 300px;
      text-align: center;
    }

    /* Fixed-height, two-line name box to prevent jitter */
    #exercise-name {
      background: white;
      color: black;
      border-color: white;
      font-weight: bold;
      font-size: 2.2rem;
      line-height: 1.2;
      height: calc(2 * 1.2em); /* exactly two lines tall */
      overflow: hidden;
      text-overflow: ellipsis;
      word-break: break-word;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .rep-box-container { display: flex; gap: 10px; margin: 1rem; }
    .rep-box {
      font-size: 2.4rem; font-weight: bold;
      border: 2px solid #999; border-radius: 10px; width: 60px; height: 60px;
      display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, #fff, #e6e6e6); color: black;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .unit-label { color: white; margin-top: -10px; text-align: center; font-size: 1.8rem; }

    /* Advanced box: badge ABOVE the text, vertical stack */
    #exercise-advanced {
      min-height: 4.2em; /* keeps the card steady even when text is blank during spin */
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: .5rem;
      justify-content: center;
      background: linear-gradient(135deg, #ffd54d, #ffb300);
      color: #111;
      border-color: #ffcc00;
      font-size: 1.7rem;
      font-weight: 700;
      text-align: center;
      margin-top: 2rem;
      position: relative;
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    }
    .adv-badge {
      padding: .2rem .5rem;
      background: #111;
      color: #ffd54d;
      border-radius: 8px;
      font-size: 0.9rem;
      letter-spacing: .08em;
    }
    #adv-text { min-height: 1.2em; } /* holds space for single-line text */

    @keyframes advPulse { from { transform: scale(1); } 50% { transform: scale(1.03); } to { transform: scale(1); } }
    .adv-pulse { animation: advPulse 1.2s ease-in-out 3; }

    button {
      background: #28a745; color: white; border: none; padding: 1.2rem 2rem; font-size: 1.5rem;
      border-radius: 12px; cursor: pointer;
      transition: background 0.3s, transform 0.1s, opacity 0.2s;
      margin-top: 2rem; width: 100%; max-width: 300px;
    }
    button:active { background: #218838; transform: scale(0.95); }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    button:focus-visible { outline: 3px solid #8fd; outline-offset: 3px; }
  </style>
</head>
<body>
  <h1>Fazzercize Randomizer</h1>
  <div class="card">
    <div id="exercise-name" class="box" aria-live="polite">Press the button to start!</div>

    <div class="rep-box-container">
      <div id="rep-digit-1" class="rep-box">-</div>
      <div id="rep-digit-2" class="rep-box">-</div>
    </div>

    <div class="unit-label" id="rep-unit" aria-live="polite"></div>

    <div id="exercise-advanced" class="box adv-pulse" aria-live="polite">
      <div class="adv-badge" aria-hidden="true">ADVANCED</div>
      <div id="adv-text">â€”</div>
    </div>

    <button id="generate-btn">GO</button>
  </div>

  <script>
    // =========================
    // Config (single source of truth for timings)
    // =========================
    const PREFERS_REDUCED = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const CONFIG = {
      NAME_SPIN_TICKS: PREFERS_REDUCED ? 6 : 16,
      DIGIT_SPIN_TICKS: PREFERS_REDUCED ? 6 : 16,
      TICK_MS: 50
    };

    // =========================
    // Data
    // =========================
    const RECENT_LIMIT = 10;
    let recentExercises = [];
    const exercises = [
      { name: "Ankle Taps", reps: "5-10", unit: "Reps", advanced: "Add 10", side: true },
      { name: "Bicycle Kicks", reps: "5-10", unit: "Reps", advanced: "Add 10", side: true },
      { name: "Burpees", reps: "3-15", unit: "Reps", advanced: "Chest to ground, and Jump at top" },
      { name: "Calf Raises", reps: "8-15", unit: "Reps", advanced: "Do for each leg separately" },
      { name: "Crunches", reps: "8-15", unit: "Reps", advanced: "Add 5" },
      { name: "Curtsy Lunges", reps: "8-10", unit: "Reps", advanced: "Add 10", side: true },
      { name: "Fast High Knees", reps: "15/20/25/30", unit: "Seconds", advanced: "Add 10s" },
      { name: "Flutter Kicks", reps: "15/20/25/30", unit: "Seconds", advanced: "Add 10s" },
      { name: "Frog Squats", reps: "8-15", unit: "Reps", advanced: "Add 10" },
      { name: "Good Mornings", reps: "5-10", unit: "Reps", advanced: "Add 5" },
      { name: "Gorilla Press", reps: "10-20", unit: "Reps", advanced: "Add 10" },
      { name: "Hollow Hold", reps: "10-25", unit: "Seconds", advanced: "Flutter your arms" },
      { name: "Kick Sits", reps: "4-8", unit: "Reps", advanced: "Do them without complaining", side: true },
      { name: "Leg Lowers", reps: "5-10", unit: "Reps", advanced: "Add 5" },
      { name: "Mountain Climbers", reps: "8-20", unit: "Reps", advanced: "Crossbody Mountain Climbers", side: true },
      { name: "Plank", reps: "30/40/50", unit: "Seconds", advanced: "Rock body forwards and backwards" },
      { name: "Plank Swivels", reps: "4-12", unit: "Reps", advanced: "Add 5", side: true },
      { name: "Press Ups", reps: "10-25", unit: "Reps", advanced: "Lift hands off ground each time" },
      { name: "Reverse Crunch", reps: "8-15", unit: "Reps", advanced: "Add a torso twist at the top" },
      { name: "Russian Twist", reps: "5-15", unit: "Reps", advanced: "Keep feet raised, add 5", side: true },
      { name: "Shuttle Run or Lap", reps: "1-2", unit: "Reps", advanced: "Pressup at each cone or corner" },
      { name: "Side Plank", reps: "20/25/30/35", unit: "Seconds", advanced: "Lower and raise hips", side: true },
      { name: "Shoulder Taps", reps: "10-20", unit: "Reps", advanced: "Add 10", side: true },
      { name: "Skaters", reps: "5-12", unit: "Reps", advanced: "Add 10", side: true },
      { name: "Squat Hold or Wall Sit", reps: "30/35/40/45/50/60", unit: "Seconds", advanced: "Raise and lower heels" },
      { name: "Squats", reps: "10-40", unit: "Reps", advanced: "Jump Squats instead" },
      { name: "Star Jumps", reps: "15-35", unit: "Reps", advanced: "Explosive Jacks instead" },
      { name: "Thread the Needle", reps: "5-10", unit: "Reps", advanced: "Do from Side Plank", side: true },
      { name: "Tricep Dips", reps: "10-20", unit: "Reps", advanced: "Diamond Press Ups instead" },
      { name: "Tuck Jumps", reps: "5-10", unit: "Reps", advanced: "Add 10" },
      { name: "Yoga Planks", reps: "5-12", unit: "Reps", advanced: "Add 5", side: true }
    ];

    // =========================
    // DOM helpers
    // =========================
    const $ = id => document.getElementById(id);
    const els = {
      name: $("exercise-name"),
      d1: $("rep-digit-1"),
      d2: $("rep-digit-2"),
      unit: $("rep-unit"),
      advBox: $("exercise-advanced"),
      advText: $("adv-text"),
      btn: $("generate-btn")
    };

    const padNumber = n => n.toString().padStart(2, '0');

    // =========================
    // Logic
    // =========================
    function parseReps(reps) {
      const str = String(reps).trim();
      if (str.includes('/')) {
        const options = str.split('/').map(r => r.trim());
        return options[Math.floor(Math.random() * options.length)];
      }
      if (str.includes('-')) {
        const [min, max] = str.split('-').map(Number);
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }
      return str;
    }

    function getRandomExerciseIndex() {
      const available = exercises.map((_, i) => i).filter(i => !recentExercises.includes(i));
      const pool = available.length > 0 ? available : exercises.map((_, i) => i);
      const idx = pool[Math.floor(Math.random() * pool.length)];
      recentExercises.push(idx);
      if (recentExercises.length > Math.min(RECENT_LIMIT, exercises.length - 1)) recentExercises.shift();
      return idx;
    }

    function animateDigits(number, onDone) {
      const repsNum = parseInt(number, 10);
      const isNumber = !Number.isNaN(repsNum);
      if (!isNumber) { onDone && onDone(); return; }

      // Hide random spin from screen readers
      els.d1.setAttribute('aria-hidden', 'true');
      els.d2.setAttribute('aria-hidden', 'true');

      const padded = padNumber(repsNum);
      let ticks = 0;
      const spinner = setInterval(() => {
        els.d1.textContent = Math.floor(Math.random() * 10);
        els.d2.textContent = Math.floor(Math.random() * 10);
        if (++ticks >= CONFIG.DIGIT_SPIN_TICKS) {
          clearInterval(spinner);
          els.d1.textContent = padded[0];
          els.d2.textContent = padded[1];
          els.d1.removeAttribute('aria-hidden');
          els.d2.removeAttribute('aria-hidden');
          onDone && onDone();
        }
      }, CONFIG.TICK_MS);
    }

    function animateExerciseName(finalName, onComplete) {
      const spinValues = exercises.map(e => e.name);
      let ticks = 0;
      const spinner = setInterval(() => {
        const randIdx = Math.floor(Math.random() * spinValues.length);
        els.name.textContent = spinValues[randIdx];
        if (++ticks >= CONFIG.NAME_SPIN_TICKS) {
          clearInterval(spinner);
          els.name.textContent = finalName;
          if (typeof onComplete === 'function') onComplete();
        }
      }, CONFIG.TICK_MS);
    }

    function setUnitNow(unit, side) {
      els.unit.textContent = `${unit}${side ? ' (each side)' : ''}`;
    }

    // Advanced text reveal happens AFTER reps spin completes
    let pendingAdvancedText = '';

    function setAdvancedText(text) {
      // Ensure node exists (defensive in case of future refactors)
      if (!els.advText) {
        const span = document.createElement('div');
        span.id = 'adv-text';
        els.advBox.appendChild(span);
        els.advText = span;
      }
      const clean = (text ?? '').toString().trim();
      els.advText.textContent = clean || 'None';

      // retrigger attention pulse each reveal
      els.advBox.classList.remove('adv-pulse');
      void els.advBox.offsetWidth; // reflow to restart CSS animation
      els.advBox.classList.add('adv-pulse');
    }

    function generateExercise() {
      // Prevent double clicks / races
      if (els.btn.disabled) return;
      els.btn.disabled = true;

      const idx = getRandomExerciseIndex();
      const exercise = exercises[idx];

      const repsRaw = parseReps(exercise.reps);
      const repsNum = parseInt(repsRaw, 10);
      const isNumber = !Number.isNaN(repsNum);

      // Context first: show correct unit immediately
      setUnitNow(exercise.unit, !!exercise.side);

      // Prepare Advanced: keep hidden during spin to sell randomizing effect
      pendingAdvancedText = exercise.advanced;
      els.advText.textContent = ''; // blank until reps/seconds are finalized

      // Prepare digits
      els.d1.textContent = isNumber ? '' : '-';
      els.d2.textContent = isNumber ? '' : '-';

      // Name spin -> digits spin -> reveal Advanced -> enable button
      animateExerciseName(exercise.name, () => {
        if (isNumber) {
          animateDigits(repsNum, () => {
            setAdvancedText(pendingAdvancedText); // reveal AFTER digits finalize
            els.btn.disabled = false;
          });
        } else {
          // Non-numeric (edge case): reveal immediately after name spin
          setAdvancedText(pendingAdvancedText);
          els.btn.disabled = false;
        }
      });
    }

    // Button click
    els.btn.addEventListener('click', generateExercise);

    // Keyboard activation for accessibility
    els.btn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        generateExercise();
      }
    });
  </script>
</body>
</html>
